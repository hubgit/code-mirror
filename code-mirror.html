<!--
Copyright 2013 The Polymer Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->
<link rel="import" href="../polymer/polymer.html">

<!-- main CodeMirror script -->
<script src="codemirror-4.1/lib/codemirror.js"></script>

<!-- JavaScript mode -->
<script src="codemirror-4.1/mode/javascript/javascript.js"></script>

<!-- Markdown mode -->
<script src="codemirror-4.1/mode/markdown/markdown.js"></script>

<!-- element -->
<polymer-element name="code-mirror" attributes="value mode theme tabSize lineNumbers lineWrapping">
  <template>
    <!-- main CodeMirror style -->
    <link href="codemirror-4.1/lib/codemirror.css" rel="stylesheet">

    <!-- CodeMirror theme -->
    <link href="codemirror-4.1/theme/xq-light.css" rel="stylesheet">

    <style>
      :host {
        display: block;
        position: relative;
      }
      .CodeMirror {
        position: relative;
        height: auto;
        width: 100%;
        border: 1px solid #eee;
      }
      .CodeMirror-scroll {
        min-height: 50px;
        max-height: 300px;
        overflow-x: auto;
      }
    </style>
  </template>

  <script>
    Polymer('code-mirror', {
      value: '',
      mode: 'javascript',
      theme: 'xq-light',
      tabSize: 2,
      lineNumbers: true,
      lineWrapping: false,
      ready: function() {
        if (!this.value) {
          this.value = this.textContent;
        }

        this.mirror = CodeMirror(this.shadowRoot, {
          value: this.value,
          mode: this.mode,
          theme: this.theme,
          tabSize: this.tabSize,
          lineNumbers: this.lineNumbers,
          lineWrapping: this.lineWrapping,
          gutters: ["CodeMirror-linenumbers"]
        });

        this.mirror.on('change', this.mirrorChanged.bind(this));
      },
      refresh: function() {
        this.mirror.refresh();
      },
      valueChanged: function() {
        if (this.value && this.value != this.mirror.getValue()) {
          this.mirror.setValue(this.value);
        }
      },
      mirrorChanged: function() {
        this.value = this.mirror.getValue();
      },
      focus: function() {
        this.mirror.focus();
      }
    });
  </script>
</polymer-element>
